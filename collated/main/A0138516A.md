# A0138516A
###### \java\seedu\tasklist\commons\util\StringUtil.java
``` java
    public static boolean containsIgnoreCase(String source, String query) {
        String[] split = source.toLowerCase().split("\\s+");
        List<String> strings = Arrays.asList(split);
        return strings.stream().filter(s -> s.contains(query.toLowerCase())).count() > 0;
    }
```
###### \java\seedu\tasklist\logic\commands\CommandHistory.java
``` java
/*
 *To store all the command used
 */

public class CommandHistory {

	private static Stack<Command> commandHistory = new Stack<Command>();

	public static void addCommandHistory(Command command) {
		commandHistory.push(command);
	}
	
	public static CommandUndoExtension getCommandHistory() {
		if (commandHistory.size() > 0) {
			return (CommandUndoExtension) commandHistory.pop();
		} else {
			throw new EmptyStackException();
		}
	}
}
```
###### \java\seedu\tasklist\logic\commands\CommandUndoExtension.java
``` java
 /*
 * For those command has implemented undo function
 */
public abstract class CommandUndoExtension extends Command {

	public String MESSAGE_UNDO = "Undo: ";

	public abstract CommandResult undo();

}
```
###### \java\seedu\tasklist\logic\commands\StorageCommand.java
``` java
/**
 * Change File path
 */

public class StorageCommand extends Command {

	private String filepath;

	public static final String COMMAND_WORD = "storage";

	public static final String MESSAGE_USAGE = COMMAND_WORD + ": Change the storage file location.\n"
			+ "Parameters: FILEPATH\n" + "Example: \n" 
			+ COMMAND_WORD + " \\data\\tasklist.xml\n"
			+ COMMAND_WORD + " \\storagefile.xml";
	public static final String MESSAGE_CHANGE_PATH_SUCCESS = "Storage file location has been updated to ";
	public static final String MESSAGE_FILE_PATH_NOT_EXIST = "Requested storage file location does not exist!";

	public StorageCommand() {
	}

	public StorageCommand(String filepath) {
		this.filepath = filepath;
	}
	
	  /**
     * Convenience constructor using raw values.
     *
     * display MESSAGE_FILE_PATH_NOT_EXIST if filepath not exist
     */
	@Override
	public CommandResult execute() {
		File file = new File(filepath);
		if (!file.isDirectory() && !filepath.contains(".xml")) {
			return new CommandResult(MESSAGE_FILE_PATH_NOT_EXIST);
		}
				
		EventsCenter.getInstance().post(new ChangePathEvent(filepath));
		model.updateTaskListAfterFilePathChange();
		return new CommandResult(MESSAGE_CHANGE_PATH_SUCCESS + filepath);
	}
	
	 /**
     * Parses arguments in the context of the storage command.
     *
     * @param args full command args string
     * @return the prepared command
     */
	@Override
	public Command prepare(String args) {
		final Matcher matcher = KEYWORDS_ARGS_FORMAT.matcher(args.trim());
		if (!matcher.matches()) {
			return new IncorrectCommand(String.format(MESSAGE_INVALID_COMMAND_FORMAT, MESSAGE_USAGE));
		}

		String filepath = args.trim();
		return new StorageCommand(filepath);

	}

}
```
###### \java\seedu\tasklist\logic\commands\UndoCommand.java
``` java
/*
 * Undo the previous command
 */

public class UndoCommand extends Command {

	public static final String COMMAND_WORD = "undo";
	public static final String MESSAGE_USAGE = COMMAND_WORD + ": undo the previous command";
	public static final String MESSAGE_UNDO_FAIL = "There is no previous undo command";

	public UndoCommand() {

	}

	@Override
	public CommandResult execute() {
		try {
			return CommandHistory.getCommandHistory().undo();
		} catch (EmptyStackException e) {
			return new CommandResult(MESSAGE_UNDO_FAIL);
		}

	}

	@Override
	public Command prepare(String args) {
		return new UndoCommand();
	}
}
```
###### \java\seedu\tasklist\model\Model.java
``` java
    /** Updates the task list after change file path*/
    void updateTaskListAfterFilePathChange();
    
```
###### \java\seedu\tasklist\model\Model.java
``` java
    /** Return the deleted task to original position**/
	void unDoDelete(int targetIndex, Task undoTask) throws TaskNotFoundException;

```
###### \java\seedu\tasklist\model\Model.java
``` java
    /** Replace the edited task to original task**/
	void unDoEdit(Task beforeEdit, Task afterEdit) throws TaskNotFoundException;
    
}
```
###### \java\seedu\tasklist\model\ModelManager.java
``` java
    @Override
    public void updateTaskListAfterFilePathChange() {
    	indicateTaskListChanged();
    }
    
```
###### \java\seedu\tasklist\model\ModelManager.java
``` java
    @Override
	public void unDoDelete(int targetIndex, Task undoTask) throws TaskNotFoundException{
    	taskList.insertTask(targetIndex, undoTask);
    	updateFilteredTaskListToShowAll();
        indicateTaskListChanged();
    }
    
```
###### \java\seedu\tasklist\model\ModelManager.java
``` java
    @Override
  	public void unDoEdit(Task beforeEdit, Task afterEdit) throws TaskNotFoundException{
    	taskList.replace(beforeEdit, afterEdit);
    	updateFilteredTaskListToShowAll();
        indicateTaskListChanged();
    	
    }
    
    //=========== Filtered Task List Accessors ===============================================================
```
###### \java\seedu\tasklist\model\task\UniqueTaskList.java
``` java
    public void insert(int targetIndex, Task undoTask) throws TaskNotFoundException{
    	internalList.add(targetIndex-1, undoTask);
	}
    
```
###### \java\seedu\tasklist\model\task\UniqueTaskList.java
``` java
    public void replace(Task beforeEdit, Task afterEdit) throws TaskNotFoundException{
		int indexToReplace = internalList.indexOf(afterEdit);
		internalList.set(indexToReplace, beforeEdit);		
	}

```
###### \java\seedu\tasklist\model\TaskList.java
``` java
    public void insertTask(int targetIndex, Task undoTask) throws TaskNotFoundException{
    	syncTagsWithMasterList(undoTask);
    	task.insert(targetIndex,undoTask);
    	
	}
    
```
###### \java\seedu\tasklist\model\TaskList.java
``` java
    public void replace(Task beforeEdit, Task afterEdit) throws TaskNotFoundException {
    	syncTagsWithMasterList(afterEdit);
    	task.replace(beforeEdit,afterEdit);
		
	}
```
